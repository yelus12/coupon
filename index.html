<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>스타시드 쿠폰등록</title>
</head>
<body style="font-size: x-large;">
    <label id="url_text" style="font-size: x-large;">
         https://yelus12.github.io/coupon/?cs_code=</label>
    <a target="_blank" id="cs_code" href=""
    style="font-size: x-large; color: #2222dd;" ></a>
</br>
<span>CS Code : </span><input type="text" id="uid"> <button onclick="makeLink()">내링크 만들기</button>
</br>
<iframe name="testFrame" id="testFrame" width="360" height="900" src="https://coupon.withhive.com/1614" 
  frameborder="1" scrolling="yes" align="left">https://coupon.withhive.com/1614</iframe>
    
    <div id="example-table" style="font-size: x-large;"></div>

    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@4.1.4/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.1.4/dist/js/tabulator.min.js"></script>

    <script>
        var myUrl = "https://yelus12.github.io/coupon/?cs_code=";
        function makeLink() {
            var myId = document.getElementById("uid").value;
            var makeUrl = myUrl+myId;
            url_text.innerText = "";
            cs_code.href = makeUrl;
            cs_code.innerText = makeUrl;
        }

        function test(code){
        navigator.clipboard.writeText(code);
        }
        const urlParams = new URL(location.href).searchParams;
        const name = urlParams.get('cs_code');
        
        var makeUrl = myUrl+name;
        if(name != null){
            url_text.innerText = "";
            cs_code.href = makeUrl;
            cs_code.innerText = makeUrl;
        }
	    var index = 0;
        var tabledata = [];

        google.charts.load('current', { packages: ['corechart'] }).then(function () {
            var query = new google.visualization.Query('https://spreadsheets.google.com/tq?tqx=out:html&tq=SELECT+B,C&key=1epBB34EvpDy1jFoTnciS4SLDxXEcPscAe9enkE6z70A&gid=30522386');
            query.send(function (response) {
                var dataTable = response.getDataTable();
                var jsonData = dataTable.toJSON();
                jsonData = JSON.parse(jsonData);
                var cscode = { id: 0, code: name, check:"cs code"};

                tabledata.push(cscode);
                for (var i = 1; i < jsonData.rows.length; i++) {
                    var data = { id: i, code: "", check:""};
                    var htmlData = jsonData.rows[i].c[0].v;
                    data['code'] = htmlData;
                    data['check'] = jsonData.rows[i].c[1].v;
                    tabledata.push(data);
                }
                

                var table = new Tabulator("#example-table", {
                    height : 900,
                    data: tabledata,           //load row data from array
                    reactiveData: true,
                    layout: "fitColumns",      //fit columns to width of table
                    responsiveLayout: "hide",  //hide columns that dont fit on the table
                    tooltips: true,            //show tool tips on cells
                    addRowPos: "top",          //when adding a new row, add it to the top of the table
                    history: true,             //allow undo and redo actions on the table
                    movableColumns: false,      //allow column order to be changed
                    resizableRows: true,       //allow row order to be changed
                    columns: [                 //define the table columns
                        { title: "Code", field: "code", width: 250, editor: false,cellClick:function(e, cell)
                        {
                            test(cell.getRow().getData().code);
                            cell.getRow().getData().check = "copy";
                            table.updateData(tabledata);
                        } },
                        { title: "Check", field: "check", width: 120, editor: false},
                    ],
                });
                
                table.updateData(tabledata);
            });
        });

    </script>
</body>
</html>
